<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8"/>
  <link rel="stylesheet" href="demo.css" type="text/css" media="screen" />
  <script src="http://code.jquery.com/jquery-3.3.1.js"></script>
  <script type="text/javascript" src="http://cloud.tinymce.com/4/tinymce.js"></script>
  <script type="text/javascript" src='../lib/tinymce/plugins/ice/plugin.js'></script>
  <script type="text/javascript" src='../lib/tinymce/plugins/icesearchreplace/plugin.js'></script>
  <script type="text/javascript" src='../lib/rangy/rangy-core.js'></script>
  <script type="text/javascript" src='../lib/uuid/uuid.js'></script>
  <script type="text/javascript" src='../src/polyfills.js'></script>
  <script type="text/javascript" src='../src/ice.js'></script>
  <script type="text/javascript" src='../src/dom.js'></script>
  <script type="text/javascript" src='../src/icePlugin.js'></script>
  <script type="text/javascript" src='../src/icePluginManager.js'></script>
  <script type="text/javascript" src='../src/bookmark.js'></script>
  <script type="text/javascript" src='../src/selection.js'></script>
  <script type="text/javascript" src='../src/plugins/IceAddTitlePlugin/IceAddTitlePlugin.js'></script>
  <script type="text/javascript" src='../src/plugins/IceCopyPastePlugin/IceCopyPastePlugin.js'></script>
  <script type="text/javascript" src='../src/plugins/IceEmdashPlugin/IceEmdashPlugin.js'></script>
  <script type="text/javascript" src='../src/plugins/IceSmartQuotesPlugin/IceSmartQuotesPlugin.js'></script>
</head>

<body>
  <h1>Ice Demo</h1>
  <button type="button" onclick="setLoremContent()">Lorem ipsum...</button>

  <div class="control">
    <strong>Set User:</strong>
    <select onchange="setUserMCE(this)">	
      <option data-userid="11" data-username="Geoffrey Jellineck">Geoffrey Jellineck</option>
      <option data-userid="22" data-username="Chuck Noblet">Chuck Noblet</option>
      <option data-userid="33" data-username="Jerri Blank">Jerri Blank</option>
    </select>
  </div>

  <br/><br/>

  <div class="container">
    <textarea id="tinymce">
      <p><span class="ice-del cts-1" data-cid="2" data-userid="33" data-username="Jerri Blank" data-time="1326764311895" title="Deleted by Jerri Blank - 01/16/2012 8:38pm">Brooklyn</span><span class="ice-ins cts-1" data-cid="3" data-userid="33" data-username="Jerri Blank" data-time="1326764319303" title="Inserted by Jerri Blank - 01/16/2012 8:38pm">Kings Point</span>, N.Y. &mdash; Adam Katz is happy to talk to reporters when he is promoting his business, a charter flight company based on Long Island called Talon Air.</p><p>But when the subject was his position as one of America's top earners, he <span class="ice-del cts-1" data-cid="23" data-userid="33" data-username="Jerri Blank" data-time="1326765043953" title="Deleted by Jerri Blank - 01/16/2012 8:50pm">hesitated</span><span class="ice-ins cts-1" data-cid="24" data-userid="33" data-username="Jerri Blank" data-time="1326765049283" title="Inserted by Jerri Blank - 01/16/2012 8:50pm">balked</span>. Seated at a desk fashioned from a jet fuel cell<span title="Inserted by Geoffrey Jellineck - 01/16/2012 8:42pm" data-time="1326764560331" data-username="Geoffrey Jellineck" data-userid="11" data-cid="20" class="ice-ins cts-3">, wearing a button-down shirt with the company logo,</span> he considered the public relations benefits and found them lacking: "It's not very popular to be in the 1 percent these days, is it?"</p><p><span class="ice-ins cts-2" data-cid="14" data-userid="22" data-username="Chuck Noblet" data-time="1326764402035" title="Inserted by Chuck Noblet - 01/16/2012 8:40pm">A few months ago, Mr. Katz was just a successful businessman with <span class="ice-del cts-3" data-cid="15" data-userid="11" data-username="Geoffrey Jellineck" data-time="1326764492624" title="Deleted by Geoffrey Jellineck - 01/16/2012 8:41pm">four</span><span class="ice-ins cts-3" data-cid="16" data-userid="11" data-username="Geoffrey Jellineck" data-time="1326764495239" title="Inserted by Geoffrey Jellineck - 01/16/2012 8:41pm">five</span> children, an $8 million home, a family real estate company in Manhattan and his passion, 10-year-old Talon Air.</span></p><p>Now, the colossal gap between the very rich and everyone else <span title="Inserted by Geoffrey Jellineck - 01/16/2012 8:46pm" data-time="1326764809499" data-username="Geoffrey Jellineck" data-userid="11" data-cid="22" class="ice-ins cts-3">&mdash; the 1 percent versus the 99 percent &mdash; </span>has become a rallying point in this election season. As President Obama positions himself as a defender of the middle class, and Mitt Romney, the wealthiest of the Republican presidential candidates, decries such talk as "the bitter politics of envy," Mr. Katz has found himself on the wrong end of a new paradigm.</p><p><span class="ice-ins cts-1" data-cid="30" data-userid="33" data-username="Jerri Blank" data-time="1326765098946" title="Inserted by Jerri Blank - 01/16/2012 8:51pm">As a member of the 1 percent, he is part of a club whose name conjures images of Wall Street bosses who are chauffeured from manse to Manhattan and fat cats who have armies of lobbyists at the ready.</span></p> <p>But in reality it is a far larger and more varied group, one that includes podiatrists and actuaries, executives and entrepreneurs, the self-made and the silver spoon set. They are clustered not just in New York and Los Angeles, but also in Denver and Dallas. The range of wealth in the 1 percent is vast &mdash; from households that bring in $380,000 a year, according to census data, up to billionaires like Warren E. Buffett and Bill Gates.</p><p>The top 1 percent of earners in a given year receives <a title="Related data from the Tax Policy Center." href="http://www.taxpolicycenter.org/numbers/displayatab.cfm?DocID=2972">just under a fifth</a> of the country's pretax income, <a title="A Congressional Budget Office report." href="http://www.cbo.gov/publications/collections/tax/2010/pre-tax_income_shares.pdf">about double their share</a> 30 years ago. They pay just over a fourth of all federal taxes, according to the Tax Policy Center. In 2007, they accounted for about 30 percent of philanthropic giving, according to Federal Reserve data. They received 22 percent of their income from capital gains, compared with 2 percent for everybody else.</p><p><span class="ice-ins cts-3" data-cid="21" data-userid="11" data-username="Geoffrey Jellineck" data-time="1326764626633" title="Inserted by Geoffrey Jellineck - 01/16/2012 8:43pm">Still, they are not necessarily the idle rich. Mr. Katz, who sometimes commutes by amphibious plane and sometimes carries luggage for Talon Air passengers, likes to say he works "26/9."</span></p> <p>Most 1 percenters were born with socioeconomic advantages, which helps explain why the 1 percent is more likely than other Americans to have jobs, according to census data. They work longer hours, being three times more likely than the 99 percent to work more than 50 hours a week, and are more likely to be self-employed. Married 1 percenters are just as likely as other couples to have two incomes, but men are the big breadwinners, earning 75 percent of the money, compared with 64 percent of the income in other households.</p><p>Though many of the wealthy lean toward the Republican Party, in interviews, 1 percenters expressed a broad range of views on how to fix the economy. They think that President Obama is ruining it, or that Republicans in Congress have gone off the deep end. They favor a flat tax, or they believe the rich should pay a higher marginal rate. Some cheered on Occupy Wall Street, saying it was about time, while others wished the protesters would just get a job or take a bath. Still others were philosophical &mdash; perhaps because they could afford to be &mdash; viewing the <a href="http://topics.nytimes.com/top/reference/timestopics/subjects/r/recession_and_depression/index.html?inline=nyt-classifier" title="More articles about the recession." class="meta-classifier">recession</a> as something that would pass, like so many previous ups and downs.</p><p><span class="ice-ins cts-2" data-cid="31" data-userid="22" data-username="Chuck Noblet" data-time="1326765165952" title="Inserted by Chuck Noblet - 01/16/2012 8:52pm">Of the 1 percenters interviewed for this article, almost all &amp;mdash; conservatives and liberals alike &amp;mdash; said the wealthy could and should shoulder more of the country's financial burden, and almost all said they viewed the current system as unfair. But they may prefer facing cuts to their own benefits like &lt;a href="http://topics.nytimes.com/top/reference/timestopics/subjects/s/social_security_us/index.html?inline=nyt-classifier" title="More articles about Social Security." class="meta-classifier"&gt;Social Security&lt;/a&gt; than paying more taxes. In &lt;a title="The survey, by the Russell Sage Foundation." href="http://www.russellsage.org/blog/r-mascarenhas/wealthiest-1-percent-and-common-good"&gt;one survey&lt;/a&gt; of wealthy Chicago families, almost twice as many respondents said they would cut government spending as those who said they would cut spending and raise revenue.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p>Even those who said the deck was stacked in their favor did not appreciate anti-rich rhetoric.</p><p>"I don't mind paying a little bit more in taxes. I don't mind putting money to programs that help the poor," said Anthony J. Bonomo of Manhasset, N.Y., who runs a medical malpractice insurance company and is a Republican. But, he said, he did mind taking a hit for the country's woes. "If those people could camp out in that park all day, why aren't they out looking for a job? Why are they blaming others?"</p><p>To many, 99 vs. 1 was an artificial distinction that overlooked hard work and moral character. "It shouldn't be relevant," said Mr. Katz , who said he both creates job and contributes to charitable causes. "I'm not hurting anyone. I'm helping a lot of people."</p><p><strong> The Enclave</strong></p><p>The placid sliver of Long Island that F. Scott Fitzgerald immortalized in "The Great Gatsby" as West Egg and East Egg seems almost to have shrugged off the recession.</p><p>A stretch of northwest Nassau County that includes Great Neck, Manhasset and Port Washington, this area has the country's highest concentration of 1 percenters, and one of the lowest unemployment rates in the state. Houses in Port Washington are worth only 10 percent less than they were at their peak, according to the <a href="http://topics.nytimes.com/top/reference/timestopics/subjects/s/standard_poors_caseshiller_home_price_index/index.html?inline=nyt-classifier" title="More articles about the Case-Shiller Home Price Index." class="meta-classifier">Standard &amp; Poor's Case-Shiller Home Price Index</a>, a far smaller decline than in the rest of the country. Yearly sales at the Americana Manhasset, the upscale granite and glass shopping center, have already exceeded their prerecession high. Even in down times, the 1 percent has <a title="Tables 1 and 2 in a related study (PDF). " href="http://www.treasury.gov/resource-center/tax-policy/Documents/incomemobilitystudy03-08revise.pdf">staying power</a>, being far more likely than any other group to stay where they are rather than slip to lower rungs of the economic ladder.</p>
    </textarea>
  </div>

  <div class="container">
    <div id="source"></div>
  </div>

  <script type="text/javascript">
    tinymce.init({
      mode: "exact",
      elements: "tinymce",
      theme: "modern",
      plugins: 'ice,icesearchreplace,contextmenu,code',
      contextmenu: 'iceaccept icereject',
      menubar: false,
      toolbar: 'code | undo redo | bold italic underline | ice_togglechanges ice_toggleshowchanges iceacceptall icerejectall iceaccept icereject',
      extended_valid_elements: "p,span[*],delete[*],insert[*]",
      init_instance_callback: function (editor) {
        editor.on('keyup',   function (e) { updateSourceView(editor); });
        editor.on('mouseup', function (e) { updateSourceView(editor); });
        editor.on('paste',   function (e) { updateSourceView(editor); });
      },
      ice: {
        user: { name: 'Geoffrey Jellineck', id: 11},
        preserveOnPaste: 'p,a[href],i,em,b,span',
        deleteTag: 'delete',
        insertTag: 'insert',
        runMode: 'demo',
        pluginPath: '../lib/tinymce/plugins/ice'    // indicates to ice where it is located; this is required because tinymce is loaded from cloud, but plugin is local
      }
    });

    function setUserMCE(el) {
      var name = $(el).find(':selected').data('username');
      var id = $(el).find(':selected').data('userid');
      tinymce.execCommand('ice_changeuser', {id: id, name: name});
    }

    function setLoremContent() {
      tinymce.activeEditor.setContent($('#loremcontent').html());
      updateSourceView(tinymce.activeEditor);
    }

    function updateSourceView (editor) {
      var parser = new DOMParser();
      var doc = parser.parseFromString(editor.getContent(), "text/html");
      var msg = processNode(doc.body);
      
      $('#source').html(msg);
    }

    function processNode(node) {
      if (node instanceof CharacterData) {
        return node.nodeValue.replace(/\n/g, '<br/><br/>');
      } else if (node instanceof Element) {
        var cc = '';
        if (node.attributes['class']) {
          var c = ' '+node.attributes['class'].textContent+' ';
          if (c.indexOf(' ice-ins ') >= 0) {
            cc = 'blue';
          } else if (c.indexOf(' ice-del ') >= 0) {
            cc = 'red';
          }
        }
        var msg = "<span class='tagname "+cc+"'>&lt;<b>" + node.tagName.toLowerCase() + "</b>";

        $.each(node.attributes, function(idx,a) {
          msg += " "+a.name+"=\""+a.textContent+"\"";
        });

        msg += "&gt;";

        $.each(node.childNodes, function(idx,n) {
          msg += processNode(n);
        });

        msg += "&lt;<b>/" + node.tagName.toLowerCase() + "</b>&gt;</span>";
        return msg;
      }
    }
  </script>

  <div id="loremcontent">
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam a turpis risus. Etiam tincidunt consequat dui, ac varius quam porttitor vitae. Cras finibus orci id ante iaculis, at volutpat ipsum tempus. Fusce lobortis sem a dui facilisis, malesuada sagittis justo eleifend. Sed hendrerit, ex nec vulputate sagittis, elit sem maximus dui, sit amet scelerisque libero dolor nec nulla. Curabitur nec dapibus nibh. Maecenas ac ante sed ex cursus finibus ac at lacus. Nam at orci volutpat, cursus mi sit amet, dapibus nisi. Morbi pellentesque, urna ac molestie convallis, sapien nulla laoreet nibh, quis viverra arcu nulla finibus velit. Vivamus metus erat, faucibus ac lobortis sed, vulputate a sem.</p>
    <p>Mauris justo magna, auctor id diam ut, mollis dictum massa. Aenean est lorem, dignissim vitae varius eu, elementum eu sapien. Nam volutpat nibh justo, tincidunt tristique nisl faucibus in. Sed vel nibh non massa blandit dictum. In tincidunt dapibus augue, eget volutpat odio ullamcorper ac. Maecenas ultricies ligula id iaculis vulputate. Aliquam pretium eget massa sit amet congue. Phasellus consequat sapien diam, vel dictum urna cursus sed. Donec a dui id urna varius pretium. Etiam nec tincidunt mi. Praesent blandit lectus et tortor facilisis, at porta mi convallis. Morbi quis luctus neque. Maecenas accumsan, arcu ut volutpat imperdiet, justo nulla placerat mi, nec scelerisque mauris purus et libero.</p>
  </div>
</body>
</html>
